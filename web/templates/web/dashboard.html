{% extends 'web/main.html' %}

{% block content %}

<br>

<div class="row">
	<div class="col-md">
		<div class="card card-body">
			<h5>Alerts by Tag</h5>
		</div>
		<div class="card card-body">
			{% include 'web/alertTagChart.html' %}
		</div>
	</div>	
	<div class="col-md">
		<div class="card card-body">
			<h5>Metrics Being Queried</h5>
			
		</div>
		<div class="card card-body">
			<table class="table">
				{% for metric in metric_names %}
					<tr>
					<td>{{ metric }}</td>
					</tr>
				{% endfor %}
			</table>
		</div>
	</div>	
	
</div>

<br>

<div class="row">
	<div class="col-md">
		<div class="card card-body">
			<h5>Recent Alerts</h5>
		</div>
		<div class="card card-body">
			<table class="table">
				<tr>
					<th>Time</th>
					<th>Severity</th>
					<th>Host</th>
					<th>Tag</th>
					<th>Metric</th>
					<th>Threshold</th>
					<th>Operator</th>
				</tr>
				{% for alert in alert_list %}
					<!--0 is the highest severity an alert can be.-->
					<!--Want to highlight the table row in red if this is the case.-->
					{% if alert.alert_rule.severity is 0 %}
					<tr style="background-color: rgb(248, 149, 149);">
					{% endif %}
					<td>{{ alert.time }}</td>
					<td>{{ alert.alert_rule.severity }}</td>
					<td>{{ alert.host.guid }}</td>
					<td>{{ alert.host_tag.name }}</td>
					<td>{{ alert.metric.name }}</td>
					<td>{{ alert.threshold }}</td>
					<td>{{ alert.operator }}</td>
					</tr>
				{% endfor %}
			</table>
		</div>
	</div>
</div>

<br>

<div class="row-sm">
	<div class="col-sm">
		<div class="card card-body">
			<h5>Host Tags</h5>
		</div>
		<div class="card card-body">
			<table class="table">
				<tr>
					<th>Tag</th>
					<th># of Hosts</th>
				</tr>
				{% for tag in tag_list %}
					<tr>
					<td><a href="{% url 'tag' tag.name %}">{{ tag.name }}</a></td>
					<td>{{ host_list }}</td>
					<td>{{ tag.registration_key }}</td>
					</tr>
				{% endfor %}
			</table>
		</div>
	</div>	
</div>

<br>

<div class="row">
	<div class="col-md">
		<div class="card card-body">
			<h5>Reports</h5>
		</div>
		<div class="card card-body">
			<table class="table">
				<tr>
					<th>Time</th>
					<th>Host Name</th>
					<th>Metric</th>
					<th>Value</th>
				</tr>
				{% for report in page_obj %}
					<tr>
					<td>{{ report.time }}</td>
					<td>{{ report.host.guid }}</td>
					<td>{{ report.metric.name }}</td>
					<td>{{ report.value }}</td>
					</tr>
				{% endfor %}
			</table>
			<!--Pagination for the reports table-->
			<div class="pagination">
				<span class="step-links">
					{% if page_obj.has_previous %}
						<a href="?page=1">&laquo; first</a>
						<a href="?page={{ page_obj.previous_page_number }}">previous</a>
					{% endif %}
			
					<span class="current">
						Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
					</span>
			
					{% if page_obj.has_next %}
						<a href="?page={{ page_obj.next_page_number }}">next</a>
						<a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
					{% endif %}
				</span>
			</div>
		</div>
	</div>	
</div>

{% endblock %}